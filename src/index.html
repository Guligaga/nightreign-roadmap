<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nightreign Roadmap</title>
    <link rel="icon" href="favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body
    class="bg-radial from-sky-950 to-indigo-950 font-cormorant text-blue-100 overflow-hidden"
    @vue:mounted="onMounted()"
  >
    <div class="h-dvh overflow-auto lg:flex" @pointerdown="onPointerDown" @pointerup="onPointerUp">
      <div
        class="bg-slate-950/10 backdrop-blur-md absolute size-full z-50 transition-all lg:hidden"
        :class="{'opacity-0 !-z-1': !drawerOpen}"
        @click="drawerOpen = false"
      ></div>

      <aside
        class="size-full max-w-md lg:max-w-2xs p-4 lg:pr-0 flex-shrink-0 flex fixed lg:static z-50 transition-transform"
        :class="{ 'translate-x-[calc(-100%+1rem)]': !drawerOpen && !isDesktop }"
      >
        <button
          class="absolute top-1/2 right-px transform -translate-y-1/2 w-4 h-24 glass rounded-r-xl cursor-pointer flex items-center justify-center z-50 lg:hidden z-50"
          @click="drawerOpen = !drawerOpen"
        >
          <i
            data-lucide="chevron-left"
            class="fill-transparent absolute w-6"
            :class="{'rotate-y-180': !drawerOpen}"
          ></i>
        </button>
        <div class="card glass size-full overflow-auto">
          <form class="flex flex-col gap-4 card-body p-4">
            <fieldset class="fieldset">
              <label class="font-semibold text-sm">Select the Nightlord:</label>
              <select
                v-model="selectedBoss"
                class="select bg-slate-800 cursor-pointer w-full"
                @change="filterMaps"
              >
                <option class="hidden"></option>
                <option v-for="boss in bosses" :key="boss.name" :value="boss">
                  {{ boss.name }}, {{ boss.title }} {{boss.alias ? `(${boss.alias})` : ''}}
                </option>
              </select>
            </fieldset>

            <fieldset class="fieldset">
              <label class="font-semibold text-sm">Select the Earth Shift:</label>
              <select
                v-model="selectedEarthShift"
                class="select bg-slate-800 cursor-pointer w-full"
                @change="filterMaps"
              >
                <option class="hidden"></option>
                <option v-for="esh in earthShifts" :key="esh.key" :value="esh">
                  {{ esh.label }}
                </option>
              </select>
            </fieldset>

            <fieldset v-if="mapLocations.length" class="fieldset">
              <label class="font-semibold text-sm">Location you see in Top Right corner:</label>
              <div class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-3 gap-2 justify-start">
                <button
                  type="button"
                  class="w-full aspect-square rounded p-px cursor-pointer glass hover:!inset-ring inset-ring-stone-100 hover:!ring ring-stone-100 hover:!border-none"
                  v-for="location in mapLocations"
                  :key="location.id"
                  :value="location"
                  @click="setResultMaps(location)"
                >
                  <div
                    v-if="location.type"
                    class="size-full bg-contain bg-center bg-no-repeat relative"
                    :style="{'background-image': `url(./assets/locations/${location.type}.png)`}"
                  >
                    <img
                      v-if="location.effect"
                      :src="`./assets/effects/${location.effectIcon}`"
                      :alt="location.effect"
                      class="size-5 absolute bottom-3 right-2 brightness-130"
                    />
                  </div>
                  <div v-else class="size-full flex items-center justify-center">
                    <span class="text-xs text-center px-1">No Location</span>
                  </div>
                </button>
              </div>
            </fieldset>

            <div class="mt-auto hidden">
              <fieldset class="fieldset flex items-center gap-2">
                <input
                  type="checkbox"
                  v-model="autenticTheme"
                  @click="toggleTheme()"
                  class="toggle theme-controller cursor-pointer !bg-transparent"
                  :style="{'--input-color': autenticTheme ? 'var(--color-blue-100)' : 'var(--color-base-content)'}"
                />
                <label class="font-semibold text-sm">Use autentic theme</label>
              </fieldset>
            </div>
          </form>
        </div>
      </aside>

      <div id="appVoice" class="fixed bottom-2 left-2 z-50">
        <div
          class="tooltip after:bg-slate-500/80"
          :class="{
          'tooltip-open': displayingTranscript,
          'tooltip-closed': !displayingTranscript,
          'after:hidden': !displayingTranscript
        }"
        >
          <div
            v-if="displayingTranscript"
            class="tooltip-content translate-x-2/5 text-lg bg-slate-500/80 max-w-[70dvw]"
          >
            {{ displayingTranscript }}
          </div>

          <button
            @click="toggleListening"
            @mousedown="vibrate()"
            @mouseup="vibrate()"
            class="relative flex justify-center items-center p-1 size-12 rounded-full bg-slate-700/80 glass cursor-pointer"
          >
            <span
              class="absolute size-full animate-ping duration-4500 rounded-full bg-slate-200 opacity-75"
              :class="{'hidden': !voiceListening}"
            >
            </span>
            <div :class="{'!hidden': !voiceListening}">
              <i data-lucide="mic" class="size-full text-white animate-heart"></i>
            </div>
            <div :class="{'!hidden': voiceListening}">
              <i data-lucide="mic-off" class="size-full text-white"></i>
            </div>
          </button>
        </div>
      </div>

      <section class="size-full p-4 overflow-auto">
        <div v-if="resultMaps.length">
          <h1 class="font-cinzel text-sm lg:text-xl text-center mb-4 rounded-xl glass p-2">
            Choose from maps below based on your <b>Spawn point</b> <br v-if="isDesktop" />
            (marked with blue arrows)
          </h1>
          <div class="grid lg:grid-cols-2 gap-4 w-full">
            <div
              v-for="map in resultMaps"
              :key="map.id"
              class="rounded-xl shadow overflow-hidden w-full aspect-square cursor-pointer"
              @click="activeMap = map"
            >
              <img
                :src="`https://thefifthmatt.github.io/nightreign/thumbnail/${map.id}.jpg`"
                alt=""
                class="w-full h-full object-cover scale-100 user-select-none pointer-events-none"
              />
            </div>
          </div>
        </div>
        <div v-else class="size-full">
          <h1 class="font-cinzel text-xl text-center mb-4 card glass py-2 px-8 lg:px-2">
            Here is no filters yet, please open sidebar
          </h1>
          <div class="card glass p-4">
            <h2 class="pb-4">And follow these steps</h2>
            <ul>
              <li class="flex items-start gap-4 mb-4">
                <div class="text-xl font-thin leading-none">1</div>
                <div class="w-full"><b>Select the Nightlord</b> you're going to fight</div>
              </li>
              <li class="flex items-start gap-4 mb-4">
                <div class="text-xl font-thin leading-none">2</div>
                <div class="w-full"><b>Select the Earth Shift</b> you see</div>
              </li>
              <li class="flex items-start gap-4 mb-4">
                <div class="text-xl font-thin leading-none">3</div>
                <div class="w-fullow">
                  <b>Select the Location</b> you see in the <b>Top Right</b> corner of the map
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div
          v-if="activeMap"
          class="fixed inset-0 bg-slate-950/70 flex items-center justify-center z-100"
          @click="activeMap = null"
        >
          <img
            :src="`https://thefifthmatt.github.io/nightreign/pattern/${activeMap.id}.jpg`"
            class="max-w-full max-h-full shadow-lg scale-130"
            @click.stop
          />

          <button
            class="fixed z-50 top-4 right-4 btn btn-circle btn-sm btn-ghost size-10 p-1 hover:glass text-current"
            @click="activeMap = null"
          >
            <i data-lucide="x" class="size-full"></i>
          </button>
        </div>
      </section>
    </div>

    <script src="https://unpkg.com/petite-vue"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module" src="./index.js"></script>
  </body>
</html>
